<wxs src="./mark.wxs" module="tool"></wxs>

<view class="container">
  <block wx:if="{{hasAuthLocation}}">
    <!-- mark 详情信息面板 -->
    <view
      class="info_panel"
      animation="{{panelAniData}}"
    >
      <!-- 关闭面板的叉叉 -->
      <view class="cancel_cross" bind:tap="closePanel">
        <image
          src="./img/cross.png"
        />
      </view>

      <view class="header_img">
        <image
          src="https://images.unsplash.com/photo-1507082529-e5ebd28d8ea1?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=f5850d6d4cc2a6e1f61a4aa1c8171187&auto=format&fit=crop&w=2767&q=80"
          class=""
        />
      </view>

      <!-- 内容 -->
      <view class="content_wrap">
        <view
          class="title"
            catch:tap="onChangeTitle"
          >
          <text>{{markTitle}}</text>
        </view>

        <view
          class="address"
          catch:tap="onChooseLocation"
        >
          <text>{{markAddress}}</text>
        </view>

        <view
          class="add_time"
          bind:tap="onShowIncidentPanel"
        >
          添加事件
        </view>

        <!-- 事件列表 -->
        <view
          class="incident_list"
        >

          <view
             class="desc"
             wx:for="{{incidents}}"
             wx:key="id"
             id="{{item.id}}"
             catch:tap="onEditIncident"
          >
            <text class="time">{{tool.toIncidentTime(item.time)}}</text>
            <view>{{item.content}}</view>

          </view>

        </view>
      </view>

      <!-- 编辑事件面板 -->
      <view
        class="incident_panel"
        wx:if="{{isShowIncidentPanel}}"
      >
        <picker
          mode="date"
          start="2000-1-1"
          end="2020-09-01"
          value="{{incidentTime}}"
          bind:change="onSelectTime"
        >
          <view class="field">
            <text class="field_name">时间:</text>
            <text class="input_area">{{tool.toIncidentTime(incidentTime)}}</text>
          </view>
       </picker>
       <view class="field">
          <text class="field_name">片语:</text>
          <input
            class="input_area"
            data-name="incident_desc"
            bindinput="onIncidentDescInput"
            value="{{incidentDesc}}"
          />
       </view>
       <view class="buttons">
         <button
           size="mini"
           catch:tap="onHideIncidentPanel"
         >取消</button>
         <button
           size="mini"
           type="primary"
           catch:tap="onSaveIincident"
         > 确认</button>
       </view>
      </view>

    </view>
    <!-- 保存按钮 -->
    <view class="save">
      <button
        type="primary"
        size="mini"
        catch:tap="onSaveMark"
      >保存</button>
    </view>

    <view style="height:100%">
      <map
        id="map"
        class="map"
        show-location="{{true}}"
        bindmarkertap="tapmarker"
        markers="{{tool.createMarkers(markerData)}}"
        bindtap="tapmarker"
      >
        <!-- 回到当前定位 -->
        <cover-view
          class="locate_icon_wrap"
          bind:tap="toMyLocation"
        >
          <cover-image class="icon_size" src="./img/locate.png"/>
        </cover-view>

        <!-- 选择一个位置 -->
        <cover-view
          class="mark_icon_wrap"
          bind:tap="chooseLocation"
        >
          <cover-image class="icon_size" src="./img/flag.png"/>
        </cover-view>

      </map>
    </view>

  </block>
  <block wx:if="{{!hasAuthLocation}}">
    <auth-page
      scope="userLocation"
      bind:getAuth="getAuth"
    />
  </block>

</view>
